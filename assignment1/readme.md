# 小作业1 数据获取

## 作业1 爬取北京链家官网二手房数据

具体爬取信息及存储要求：

- 要求爬取东城、西城、海淀、朝阳四个城区的二手房数据（每个城区爬取前5页），提取楼盘名称、平米数、总价、单价
- 将信息保存在 csv 文件中（可以是一个，也可以是每城区一个）

### 源代码

位于 `lianjia/lianjia.py`

```python
import requests
from lxml import etree
import csv

root_url = 'https://bj.lianjia.com'
url = 'https://bj.lianjia.com/ershoufang/'

# 伪造请求头
headers = {
    'user-agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36'
}

response = requests.get(url, headers=headers)

html = etree.HTML(response.text)

areas = html.xpath('/html/body/div[3]/div/div[1]/dl[2]/dd/div[1]/div/a')

targets = ['东城', '西城', '朝阳', '海淀']

for area in areas:
    if area.text in targets:
        # 获取每个区域的url，去掉最后的pg1
        area_url = root_url + area.xpath('./@href')[0].replace('pg1', '')
        # 存储爬取的数据
        data = []
        for i in range(5): # 爬取前5页
            page_url = area_url + 'pg' + str(i + 1) # 拼接每一页的url，如https://bj.lianjia.com/ershoufang/dongcheng/pg1
            response = requests.get(page_url, headers=headers)
            response.encoding = 'utf-8'
            html = etree.HTML(response.text)
            # 获取每一页的房源信息
            sell_list = html.xpath('/html/body/div[4]/div[1]/ul/li')
            for sell in sell_list:
                # 获取每一条房源信息的楼盘名称、面积、总价、单价
                title = sell.xpath('./div/div[2]/div/a/text()')[0].strip()
                area_value = sell.xpath('./div/div[3]/div/text()')[0].split('|')[1].replace('平米', '').strip()
                total_price = sell.xpath('./div/div[6]/div[1]/span/text()')[0].strip()
                unit_price = sell.xpath('./div/div[6]/div[2]/span/text()')[0].replace('元/平', '').replace(',', '').strip()
                # 将每一条房源信息存入data
                data.append([title, area_value, total_price, unit_price])
        # 将数据写入csv文件
        with open(area.text + '.csv', 'w', newline='', encoding='utf-8') as f:
            writer = csv.writer(f)
            writer.writerow(['title', 'area_value', 'total_price', 'unit_price'])
            writer.writerows(data)

```

### 输出结果

东城

```csv
title,area_value,total_price,unit_price
龙潭西里,46.98,498,106003
东四块玉北街,46.96,425,90503
胡家园小区,64.01,600,93736
煤渣胡同,52.7,590,111955
中绦胡同甲2号院,59.15,780,131869
西营房,57.26,570,99546
长青园,57.99,455,78462
东直门内大街,91.53,960,104884
仓南胡同,71.39,888,124388
恒基中心,168.41,1150,68286
雅宝公寓,139.62,1580,113165
法华南里,81.68,799,97821
新景家园东区,59.19,665,112351
民旺园,55.33,679,122719
胡家园小区,83.36,920,110365
安外东河沿,64.64,830,128404
安贞苑50号院,88.95,1050,118044
兴隆都市馨园,52.76,525,99508
安外东河沿,67.03,798,119052
崇文门西大街,65.29,695,106449
安外东河沿,96.62,1199,124095
城市亮点,84,805,95834
西堂子胡同,54.39,616,113257
和平里五区,55.12,699,126815
富莱茵花园,148.63,930,62572
和平里六区,142.7,1730,121234
和平里六区,142.7,1700,119132
禾风仕家,75.47,1190,157679
中海紫御公馆,92.25,1298,140705
花市枣苑三期,113.23,1260,111278
小黄庄二区,108.65,1198,110263
柏林寺西,60.68,755,124424
北总布胡同,86.31,930,107752
华龙美晟,90.52,775,85617
香饵胡同,81.45,1120,137508
永定门东街西里,53.26,420,78859
雍和家园一期,179.48,2200,122577
和平里七区,57.08,681,119307
化工大院,68.26,799,117053
广渠家园,51.12,499,97614
东晓市街,48.81,413,84614
东花市北里东区,75.12,855,113818
民旺园,63.84,845,132363
西水井胡同,74.31,755,101602
城市亮点,100.03,835,83475
革新南路2号院,73.12,520,71116
东直门内大街,63.66,728,114358
芳嘉园胡同,69.51,775,111495
湖景苑,146.65,1920,130924
安德里北街25号院,87.98,850,96613
...
```

西城

```csv
title,area_value,total_price,unit_price
南礼士路46号院,146.05,2350,160904
车站东街15号院,62.77,650,103553
广安小区,122.79,1099,89503
鸭子桥南里,60.39,499,82630
华裕园小区,53,768,144906
新街口西里三区,51.15,630,123168
复兴门北大街,77.5,990,127742
永居东里,43.9,429,97723
新纪元公寓,96.71,1047,108262
马连道路5号院,54.71,529,96692
裕中西里,85.9,1060,123400
广安门外大街,69,760,110145
车公庄中里,107.9,1381,127989
核桃园,75.24,730,97023
西直门南大街东区,77.6,1047,134923
白广路二条4号院,85.63,650,75908
侨办大院,48.7,598,122793
教场口街2号院,95.1,1588,166983
新文化街,67.3,958,142348
源屋曲,144.54,1580,109313
月坛北小街5号院,100.7,1100,109236
广安苑一期,34.26,435,126971
小后仓,62.4,798,127885
三里河二区A区,84.3,1510,179123
新街口七条15号院,48.1,570,118504
双旗杆东里,59.4,850,143098
湾子街社区,57.74,498,86249
万明园,68.3,888,130015
信和嘉园,122.98,1560,126850
车站西街15号院,39.18,410,104646
文联宿舍,80.6,1250,155087
展览路,67.6,615,90977
贵都国际,133.55,520,38937
新外大街甲8号院,89.8,1050,116927
鼓楼西大街,83.7,1160,138591
西绒线,139.94,1360,97185
一瓶,188.27,3125,165986
月坛北街,60.9,899,147620
西直门南大街东区,110,1480,134546
阳光丽景,137.04,2399,175059
羊肉胡同120号院,81.8,1120,136920
天宁寺西里,44.56,410,92011
三义东里,38.99,455,116697
阜成门外大街,74,986,133244
白云观,51,550,107844
佟麟阁路62号院,49.7,880,177063
德胜里一区,46.5,760,163441
铁二区,38.9,680,174808
西便门外大街,49.5,558,112728
月坛北街,53.3,726,136211
...
```

朝阳

```csv
title,area_value,total_price,unit_price
水郡长安,150.12,758,50493
柳芳南里,88.77,760,85615
朝阳旺角,137.37,630,45862
银枫家园,120.43,600,49822
海棠公社,147.18,670,45523
富力又一城A区,141.99,649,45708
电建北院,70.96,345,48619
八里庄北里1号院,61.59,356,57802
东恒时代三期,123.4,750,60778
远洋一方林语苑,66.66,315,47255
八里庄北里小区,66.73,366,54848
汇景苑三区,86.87,425,48924
首开畅心园,70.27,300,42693
黄金苑,122.69,560,45644
安贞里,68.34,588,86041
晨光家园A区,82.58,495,59942
安贞西里,57.15,518,90639
小关东里10号院,55.53,480,86440
丽水嘉园,95.36,939,98469
保利嘉园三号院,89.3,459,51400
十里堡北里,61.87,328,53015
华威西里,44.3,240,54177
东大桥东里,83.77,650,77594
和平街十区,66.4,540,81326
慧谷时空,110.67,730,65962
新源西里中街,53.85,380,70567
安慧北里秀园,63.03,470,74568
慧忠里B区,57.74,585,101317
翠成馨园D区,55.9,238,42577
北京新天地二期,101.64,539,53031
富力又一城A区,169.59,799,47114
万象新天天际高尔夫,139.17,868,62370
英特公寓,227.33,1300,57186
望馨花园,114.61,930,81145
劲松四区,81.18,445,54817
弘善家园,89.08,435,48833
银谷美泉家园,152.4,1240,81365
华威北里,81.28,422,51920
银枫家园,215.29,899,41758
锦绣馨园,119.6,820,68562
美丽亚洲假日花园,146.73,645,43959
潘家园东里,90.06,509,56518
力鸿花园,132.73,1035,77978
垂杨柳北里,61.32,359,58546
金隅景和园,90.05,529,58746
安贞西里,61.52,469,76236
世纪东方城,137.14,878,64023
壹线国际,119.32,680,56990
农光里,123.95,830,66963
华龙美树,120.75,678,56150
...
```

海淀

```csv
title,area_value,total_price,unit_price
永金里小区,120.99,889,73478
田村山南路9号院,83.71,618,73827
美丽园,144.1,1650,114504
乐府江南,137.23,1480,107849
八里庄北里,93.19,905,97114
金尚嘉园,165.01,2380,144234
秋露园,55.69,500,89783
增光路甲34号,74.64,709,94990
北洼东里,83.77,890,106244
翠微南里,69.54,768,110441
大泥湾,54.92,639,116352
新外大街31号院,66.3,515,77678
智学苑,69.05,475,68791
稻香园,71.49,690,96517
中信所小区,54.5,575,105505
智慧大厦,98.08,780,79527
领秀硅谷,144,1179,81875
育新花园,102.6,790,76999
增光路36号院,110.87,1130,101922
诚品建筑,168.95,1790,105949
宝盛里,85.69,540,63018
今日家园,125.72,930,73974
汤泉逸墅,197.39,2080,105376
黄庄小区,127.1,1700,133753
什坊院,87.35,850,97310
缘溪堂,317.3,3450,108730
绿波漫板,164.31,1789,108880
玉海园二里,124.12,878,70738
西四环中路41号院,137.8,896,65022
今日家园,130.69,960,73457
阜成路甲52号院,81.61,665,81486
富力桃园C区,89.64,670,74744
蓟门东里,56,498,88929
农影小区,92.33,1190,128886
景王坟,88.1,880,99887
学院派,61.03,549,89956
清华园,44.4,699,157433
金谷园,95.04,969,101958
文慧园,61.2,599,97876
清缘里中区,97.24,543,55842
北洼西里,54.5,485,88991
双榆树西里,58.54,649,110865
清华园,60.8,670,110198
保利西山林语,90.33,540,59781
铁东小区,83.7,769,91876
七贤村,57.8,555,96021
皂君东里,50.6,480,94862
钢铁研究院,63,555,88096
郦城三区,98.38,1165,118419
机械研究院西区,90.3,1100,121817

```

## 作业2 爬取豆瓣电影 Top 250 数据

具体爬取信息及存储要求：

- 要求爬取全部 250 部电影的数据，提取电影的中文片名、宣传语、评分、评价人数。（例：肖申克的救赎，“希望让人自由。”，9.7，2733274）
- 将信息保存在 csv 文件中

### 源代码

位于 `douban/douban.py`

```python
import requests
from lxml import etree
import csv

# 豆瓣电影top250的url
url = ['https://movie.douban.com/top250?start=', 0, '&filter=']

# 伪造请求头
headers = {
    'user-agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36'
}

# 存储爬取的数据
data = []

# 每页25条数据，共10页
for i in range(10):
    url[1] = i * 25
    # 发送请求
    response = requests.get(''.join([url[0], str(url[1]), url[2]]), headers=headers)
    response.encoding = 'utf-8'

    # 解析html
    html = etree.HTML(response.text)

    # 获取每一页的电影信息列表
    items = html.xpath('//*[@id="content"]/div/div[1]/ol/li')

    for item in items:
        # 获取每一条电影信息的中文标题、短评、评分、评价人数
        title = item.xpath('./div/div[2]/div[1]/a/span[1]/text()')[0].strip()
        try:
            comment = item.xpath('./div/div[2]/div[2]/p[2]/span/text()')[0].strip()
        except IndexError:
            comment = 'NULL' # 有些电影没有短评
        score = item.xpath('./div/div[2]/div[2]/div/span[2]/text()')[0].strip()
        number = item.xpath('./div/div[2]/div[2]/div/span[4]/text()')[0].replace('人评价', '').strip()
        # 将每一条电影信息存入data
        data.append([title, comment, score, number])
    
# 将数据写入csv文件
with open('豆瓣top250.csv', 'w', newline='', encoding='utf-8') as f:
    writer = csv.writer(f, delimiter='|')
    writer.writerow(['title', 'comment', 'score', 'number'])
    writer.writerows(data)

```

### 输出结果

```csv
title|comment|score|number
肖申克的救赎|希望让人自由。|9.7|2945541
霸王别姬|风华绝代。|9.6|2176118
阿甘正传|一部美国近现代史。|9.5|2195337
泰坦尼克号|失去的才是永恒的。|9.5|2229167
这个杀手不太冷|怪蜀黍和小萝莉不得不说的故事。|9.4|2327320
千与千寻|最好的宫崎骏，最好的久石让。|9.4|2279013
美丽人生|最美的谎言。|9.5|1346457
星际穿越|爱是一种力量，让我们超越时空感知它的存在。|9.4|1884916
盗梦空间|诺兰给了我们一场无法盗取的梦。|9.4|2099519
辛德勒的名单|拯救一个人，就是拯救整个世界。|9.5|1137251
楚门的世界|如果再也不能见到你，祝你早安，午安，晚安。|9.4|1747693
忠犬八公的故事|永远都不能忘记你所爱的人。|9.4|1416749
海上钢琴师|每个人都要走一条自己坚定了的路，就算是粉身碎骨。|9.3|1702354
三傻大闹宝莱坞|英俊版憨豆，高情商版谢耳朵。|9.2|1885695
放牛班的春天|天籁一般的童声，是最接近上帝的存在。|9.3|1333016
机器人总动员|小瓦力，大人生。|9.3|1336947
疯狂动物城|迪士尼给我们营造的乌托邦就是这样，永远善良勇敢，永远出乎意料。|9.2|1977129
无间道|香港电影史上永不过时的杰作。|9.3|1389295
控方证人|比利·怀德满分作品。|9.6|578851
大话西游之大圣娶亲|一生所爱。|9.2|1556156
熔炉|我们一路奋战不是为了改变世界，而是为了不让世界改变我们。|9.4|945061
教父|千万不要记恨你的对手，这样会让你失去理智。|9.3|984842
触不可及|满满温情的高雅喜剧。|9.3|1138644
当幸福来敲门|平民励志片。|9.2|1542522
末代皇帝|“不要跟我比惨，我比你更惨”再适合这部电影不过了。|9.3|904011
寻梦环游记|死亡不是真的逝去，遗忘才是永恒的消亡。|9.1|1716876
龙猫|人人心中都有个龙猫，童年就永远不会消失。|9.2|1285563
怦然心动|真正的幸福是来自内心深处。|9.1|1861575
活着|张艺谋最好的电影。|9.3|862292
哈利·波特与魔法石|童话世界的开端。|9.2|1217326
蝙蝠侠：黑暗骑士|无尽的黑暗。|9.2|1079558
指环王3：王者无敌|史诗的终章。|9.3|817115
我不是药神|对我们国家而言，这样的电影多一部是一部。|9.0|2137610
乱世佳人|Tomorrow is another day.|9.3|703316
飞屋环游记|最后那些最无聊的事情，才是最值得怀念的。|9.1|1347832
素媛|受过伤害的人总是笑得最开心，因为他们不愿意让身边的人承受一样的痛苦。|9.3|698616
哈尔的移动城堡|带着心爱的人在天空飞翔。|9.1|1045128
十二怒汉|1957年的理想主义。|9.4|501135
何以为家|凝视卑弱生命，用电影改变命运。|9.1|1061288
摔跤吧！爸爸|你不是在为你一个人战斗，你要让千千万万的女性看到女生并不是只能相夫教子。|9.0|1591927
让子弹飞|你给我翻译翻译，神马叫做TMD的惊喜。|9.0|1726988
猫鼠游戏|骗子大师和执著警探的你追我跑故事。|9.1|1048840
天空之城|对天空的追逐，永不停止。|9.2|891867
鬼子来了|对敌人的仁慈，就是对自己残忍。|9.3|637482
少年派的奇幻漂流|瑰丽壮观、无人能及的冒险之旅。|9.1|1367874
海蒂和爷爷|如果生活中有什么使你感到快乐，那就去做吧！不要管别人说什么。|9.3|634777
钢琴家|音乐能化解仇恨。|9.3|654793
大话西游之月光宝盒|旷古烁今。|9.0|1239068
指环王2：双塔奇兵|承前启后的史诗篇章。|9.2|766759
闻香识女人|史上最美的探戈。|9.1|903664
.
```

